{%- import 'macros.j2' as macros -%}
{# Title & Description -#}
## {{ fieldset['title'] }} Fields

{{ fieldset['description']|replace("\n", "\n\n") }}

{# Fieldset label beta header -#}
{% if fieldset['beta'] -%}

> **Beta:** {{ fieldset['beta'] }}

{% endif -%}

{# Field Details Table Header -#}
### {{ fieldset['title'] }} Field Details

| Field  | Description | Level |
|--------|------------|-------|

{# Iterate through each field in the set -#}
{% for field in sorted_fields -%}
{% if 'original_fieldset' not in field -%}

| **[{{ field['flat_name'] }}](#field-{{ field['dashed_name'] }})** |

{% if field['beta'] -%}
**Beta:** {{ field['beta'] }}
{{ field['description']|replace("\n", "\n\n") }}
{%- else -%}
{{ field['description']|replace("\n", "\n\n") }}
{%- endif %}

{% if field['expected_values'] %}

**Expected values for this field:**
{% for val in field['expected_values'] %}
- `{{ val }}`
{%- endfor %}
{%- endif %}

**Type:** {{ field['type'] }}

{% if 'multi_fields' in field -%}

**Multi-fields:**
{% for mf in field['multi_fields'] -%}
- {{ mf['flat_name'] }} (type: {{ mf['type'] }})
{% endfor %}
{% endif %}

{% if 'array' in field['normalize'] -%}

**Note:** This field should contain an array of values.

{% endif %}

{% if 'allowed_values' in field %}

**Important:** The field value must be one of the following:

{{ field['allowed_value_names']|join(', ') }}

For more details, see [allowed values for {{ field['flat_name'] }}](#ecs-allowed-values-{{ field['dashed_name'] }}).

{% elif 'example' in field -%}

**Example:** `{{ field['example'] }}`

{%- endif %}

{% if field['otel'] -%}
{%- for otel in field['otel'] %}

{{ macros.otel_badge }} {{ macros.otel_relation_badge(otel) }} {{ macros.otel_link(field, otel) }}

{%- if 'note' in otel %}

**Note:** {{ otel['note'] }}
{%- endif %}
{%- endfor %}
{%- endif %}

| {{ field['level'] }} |

{% endif %}
{% endfor %}

{# Field Reuse Section -#}
{% if 'nestings' in fieldset or 'reusable' in fieldset -%}

### Field Reuse

{% if 'reusable' in fieldset -%}

The `{{ fieldset['name'] }}` fields are expected to be nested at:

{% for entry in sorted_reuse_fields %}
- `{{ entry }}`
{% endfor %}

{% if 'top_level' in fieldset['reusable'] and fieldset['reusable']['top_level'] -%}

**Note:** The `{{ fieldset['name'] }}` fields may be used directly at the root of the events.

{% else -%}

**Note:** The `{{ fieldset['name'] }}` fields are not expected to be used directly at the root of the events.

{%- endif %}
{% endif %}

{% if 'nestings' in fieldset -%}

#### Field sets that can be nested under {{ fieldset['title'] }}

| Location | Field Set | Description |
|----------|----------|-------------|

{% for entry in render_nestings_reuse_section -%}
| `{{ entry['flat_nesting'] }}` |
| [{{ entry['name'] }}](#ecs-{{ entry['name'] }}) |

{% if entry['beta'] -%}
**Beta:** {{ entry['beta'] }}
{{ entry['short'] }}
{%- else %}
{{ entry['short'] }}
{%- endif %}

{% if entry['normalize'] and 'array' in entry['normalize'] -%}

**Note:** This reuse should contain an array of {{ entry['name'] }} field set objects.

{% endif -%}

{% endfor -%}

{% endif %}
{% endif %}

{%- if usage_doc %}

### {{ fieldset['title'] }} Field Usage

For usage and examples of the `{{ fieldset['name'] }}` fields, see [{{ fieldset['title'] }} Fields Usage and Examples](#ecs-{{ fieldset['name']|replace("_", "-") }}-usage).

{% endif %}

